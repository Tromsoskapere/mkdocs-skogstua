name: Build and Deploy MkDocs (SFTP)

# Kj칮rer hver gang en endring blir pushet til 'main'-grenen
on:
  push:
    branches:
      - main
  pull_request: # Kj칮rer ogs친 p친 Pull Requests

# Jobben som skal gj칮res
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # Bruker en standard Linux-maskin
    
    steps:
    # 1. Sjekker ut koden fra repoet
    - name: 拘勇 Checkout code
      uses: actions/checkout@v4

    # 2. Setter opp Python (som MkDocs trenger)
    - name: 游냀 Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: 3.x

    # 3. Installerer MkDocs og alle pluginene dere bruker
    - name: 游닍 Install MkDocs & Plugins
      run: |
        pip install mkdocs-material
        pip install mkdocs-awesome-pages-plugin
        pip install mkdocs-section-index
        pip install mkdocs-macros-plugin
        # Legg til 'pip install ...' for andre plugins her

    # 4. Bygger den statiske nettsiden
    # Denne kommandoen lager 'site/'-mappen med all HTML/CSS
    - name: 游댣 Build MkDocs site
      run: mkdocs build

# 5. Laster opp til webhotellet via rsync/ssh (Kun hvis det er 'main')
    - name: 拘勇 Upload to Server (rsync)
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      run: |
        # 1. Opprett SSH-mappen
        mkdir -p ~/.ssh
        
        # 2. Installer den private n칮kkelen
        echo "${{ secrets.SFTP_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        
        # 3. Legg til serveren i kjente verter (omg친r "Permanently added" varselet)
        ssh-keyscan -H ${{ secrets.SFTP_HOST }} >> ~/.ssh/known_hosts
        
        # 4. Synkroniser 'site/'-mappen til serveren med rsync
        # -avz = archive, verbose, compress
        # --delete = sletter filer p친 serveren som ikke er i 'site/'
        rsync -avz --delete \
          ./site/ \
          ${{ secrets.SFTP_USER }}@${{ secrets.SFTP_HOST }}:${{ secrets.REMOTE_PATH }}
