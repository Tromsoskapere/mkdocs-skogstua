name: üöÄ Deploy MkDocs (rsync)

# Kj√∏rer hver gang du pusher til 'main'-grenen
on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: üéâ Bygg og Deploy
    runs-on: ubuntu-latest
    steps:
    
    # 1. Henter koden din fra GitHub
    - name: üöö Hent koden
      uses: actions/checkout@v4

    # 2. Setter opp Python (som MkDocs trenger)
    - name: üêç Sett opp Python
      uses: actions/setup-python@v5
      with:
        python-version: 3.x

    # 3. Installerer MkDocs og de nye pluginene dine
    - name: üì¶ Installer MkDocs & Plugins
      run: |
        pip install mkdocs
        pip install mkdocs-material
        pip install mkdocs-awesome-nav
        pip install mkdocs-pagetree-plugin
    
    # 4. Bygger den statiske nettsiden (lager 'site/'-mappen)
    - name: üî® Bygg MkDocs-siden
      run: mkdocs build

    # 5. Laster opp til webhotellet via rsync/ssh
    - name: ‚¨ÜÔ∏è Upload to Server (rsync)
      run: |
        # 1. Opprett SSH-mappen
        mkdir -p ~/.ssh
        
        # 2. Installer den private n√∏kkelen fra GitHub Secrets
        echo "${{ secrets.SFTP_KEY }}" > ~/.ssh/id_rsa
        
        # 3. L√•s filen (viktig!)
        chmod 600 ~/.ssh/id_rsa
        
        # 4. Legg til serveren i kjente verter (omg√•r "host key verification")
        ssh-keyscan -H ${{ secrets.SFTP_HOST }} >> ~/.ssh/known_hosts
        
        # 5. Synkroniser 'site/'-mappen til serveren med rsync
        # -avz = archive, verbose, compress
        # --delete = sletter filer p√• serveren som ikke er i 'site/'
        rsync -avz --delete \
          ./site/ \
          ${{ secrets.SFTP_USER }}@${{ secrets.SFTP_HOST }}:${{ secrets.REMOTE_PATH }}
