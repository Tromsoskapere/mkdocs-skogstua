name: Build and Deploy MkDocs (SFTP)

# Kj√∏rer hver gang en endring blir pushet til 'main'-grenen
on:
  push:
    branches:
      - main
  pull_request: # Kj√∏rer ogs√• p√• Pull Requests

# Jobben som skal gj√∏res
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # Bruker en standard Linux-maskin
    
    steps:
    # 1. Sjekker ut koden fra repoet
    - name: ‚¨áÔ∏è Checkout code
      uses: actions/checkout@v4

    # 2. Setter opp Python (som MkDocs trenger)
    - name: üêç Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: 3.x

    # 3. Installerer MkDocs og alle pluginene dere bruker
    - name: üì¶ Install MkDocs & Plugins
      run: |
        pip install mkdocs-material
        pip install mkdocs-awesome-pages-plugin
        pip install mkdocs-section-index
        pip install mkdocs-macros-plugin
        # Legg til 'pip install ...' for andre plugins her

    # 4. Bygger den statiske nettsiden
    # Denne kommandoen lager 'site/'-mappen med all HTML/CSS
    - name: üî® Build MkDocs site
      run: mkdocs build

    # --- LEGG TIL DENNE NYE BLOKKEN ---
    - name: üêõ List files in workspace
      run: ls -laR
    # -----------------------------------

    # 5. Laster opp til webhotellet via SFTP (wlixcc)
    - name: ‚¨ÜÔ∏è Upload to SFTP (wlixcc)
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: wlixcc/SFTP-Deploy-Action@v1.2.4
      with:
        server: ${{ secrets.SFTP_HOST }}
        username: ${{ secrets.SFTP_USER }}
        password: ${{ secrets.SFTP_PASSWORD }}
        port: 22
        local_path: site/* 
        remote_path: ${{ secrets.REMOTE_PATH }}
        sftp_only: true
        delete_remote_files: false
